{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getSysAttractionsById, saveSysAttractionOrder, getSysCommentsPage, saveSysComments } from '../../api/api';\nimport headers from '@/components/header';\nimport bottoms from '@/components/bottom';\nexport default {\n  data() {\n    return {\n      id: \"\",\n      dialogVisible: false,\n      search: {\n        attractionsId: \"\",\n        pageSize: 10,\n        pageNumber: 1\n      },\n      info: {},\n      total: 100,\n      tableData: [],\n      content: \"\",\n      score: null,\n      num: \"\",\n      userId: null,\n      people: [{\n        name: \"\",\n        tel: \"\",\n        idCard: \"\"\n      }]\n    };\n  },\n  components: {\n    headers,\n    bottoms\n  },\n  methods: {\n    saveSysComments() {\n      if (!this.content) {\n        this.$message({\n          message: '请输入评论内容',\n          type: 'warning'\n        });\n        return;\n      }\n      var param = {\n        content: this.content,\n        score: this.score,\n        attractionsId: this.id,\n        userId: this.userId\n      };\n      saveSysComments(param).then(res => {\n        if (res.code == 1000) {\n          this.$message({\n            message: '评论成功',\n            type: 'success'\n          });\n          this.content = \"\";\n          this.getSysCommentsPage();\n        }\n      });\n    },\n    getSysCommentsPage() {\n      this.search.attractionsId = this.id;\n      getSysCommentsPage(this.search).then(res => {\n        if (res.code == 1000) {\n          this.tableData = res.data.records;\n          this.total = res.data.total;\n        }\n      });\n    },\n    closeOrder() {\n      this.date1 = \"\";\n      this.num = \"\";\n      this.people = [{\n        name: \"\",\n        tel: \"\",\n        idCard: \"\"\n      }], this.dialogVisible = false;\n    },\n    saveOrder() {\n      if (!this.date1) {\n        this.$message({\n          message: '请选择预约时间',\n          type: 'warning'\n        });\n        return;\n      }\n      if (this.people.length < this.num) {\n        this.$message({\n          message: '请完善预约人信息',\n          type: 'warning'\n        });\n        return;\n      }\n      if (this.people.length > this.num) {\n        this.$message({\n          message: '预约人信息超出预约人数',\n          type: 'warning'\n        });\n        return;\n      }\n      for (let i = 0; i < this.people.length; i++) {\n        var item = this.people[i];\n        if (!item.name) {\n          this.$message({\n            message: '请完善预约人姓名',\n            type: 'warning'\n          });\n          return;\n        }\n        if (!item.tel) {\n          this.$message({\n            message: '请完善预约人联系方式',\n            type: 'warning'\n          });\n          return;\n        }\n        if (this.info.realName == 1 && !item.idCard) {\n          this.$message({\n            message: '请完善预约人证件号',\n            type: 'warning'\n          });\n          return;\n        }\n      }\n      var param = {\n        attractionsId: this.id,\n        num: this.num,\n        time: this.date1,\n        people: JSON.stringify(this.people)\n      };\n      saveSysAttractionOrder(param).then(res => {\n        if (res.code == 1000) {\n          this.$message({\n            message: '预约成功，请等待确认',\n            type: 'success'\n          });\n          this.closeOrder();\n        } else {\n          this.$message({\n            message: res.message,\n            type: 'warning'\n          });\n        }\n      });\n    },\n    getSysAttractionsById() {\n      getSysAttractionsById({\n        id: this.id\n      }).then(res => {\n        if (res.code == 1000) {\n          this.info = res.data;\n        }\n      });\n    },\n    toOrder() {\n      this.dialogVisible = true;\n    },\n    addKeyword() {\n      var param = {\n        name: \"\",\n        tel: \"\",\n        idCard: \"\"\n      };\n      this.people.push(param);\n    },\n    minusKeyword(index) {\n      this.people.splice(index, 1);\n    },\n    handleCurrentChange() {}\n  },\n  created() {},\n  mounted() {\n    this.id = this.$route.query.id;\n    this.userId = JSON.parse(window.localStorage.getItem(\"user_info\")).id;\n    this.getSysAttractionsById();\n    this.getSysCommentsPage();\n  }\n};","map":{"version":3,"names":["getSysAttractionsById","saveSysAttractionOrder","getSysCommentsPage","saveSysComments","headers","bottoms","data","id","dialogVisible","search","attractionsId","pageSize","pageNumber","info","total","tableData","content","score","num","userId","people","name","tel","idCard","components","methods","$message","message","type","param","then","res","code","records","closeOrder","date1","saveOrder","length","i","item","realName","time","JSON","stringify","toOrder","addKeyword","push","minusKeyword","index","splice","handleCurrentChange","created","mounted","$route","query","parse","window","localStorage","getItem"],"sources":["src/views/attractions/attractionsInfo.vue"],"sourcesContent":["<template>\r\n  <div class=\"attractionsInfo\">\r\n    <headers></headers>\r\n    <div class=\"attractionsInfo1\">\r\n        <div class=\"attractionsInfo2\">\r\n            <div class=\"attractionsInfo3\">\r\n                <el-carousel height=\"500px\">\r\n                    <el-carousel-item v-for=\"(item,index) in info.images.split(',')\" :key=\"index\">\r\n                        <img style=\"width:100%;height:100%\" :src=\"item\">\r\n                    </el-carousel-item>\r\n                </el-carousel>\r\n            </div>\r\n            <div class=\"attractionsInfo4\">\r\n                <div class=\"attractionsInfo5\">{{info.name}}</div>\r\n                <div class=\"attractionsInfo5\">价格：{{info.price}}（元）</div>\r\n                <div style=\"margin-left:20px;margin-top:10px\">库存：{{info.num}} -{{info.realName == 0?'非实名':'实名'}}</div>\r\n                <div class=\"attractionsInfo6\">{{info.introduce}}</div>\r\n                <div class=\"attractionsInfo7\" style=\"margin-left:15px\">\r\n                    <el-button  type=\"primary\" plain @click=\"toOrder\">立即预约</el-button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"attractionsInfo1\">\r\n        <div class=\"attractionsInfo8\" >\r\n            <div style=\"margin-left:20px;margin-right:20px;margin-top:20px\">\r\n                介绍：{{info.content}}\r\n            </div>\r\n            <div style=\"margin-left:20px;margin-right:20px;margin-top:20px\">\r\n                预约须知：{{info.open}}\r\n            </div>\r\n            <div style=\"margin-left:20px;margin-right:20px;margin-top:20px;margin-bottom:20px\">\r\n                入园时间：{{info.time}}\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"attractionsInfo1\">\r\n        <div class=\"attractionsInfo8\">\r\n            <el-input style=\"margin-top:20px\" v-model=\"content\" type=\"textarea\" rows=\"7\" placeholder=\"请输入评论内容\"></el-input>\r\n           <el-rate v-model=\"score\"></el-rate>\r\n            <el-button style=\"margin-top:20px\" type=\"primary\"  plain @click=\"saveSysComments\">评论</el-button>\r\n            <div class=\"forum1\" style=\"width:100%\">\r\n                <div class=\"forum2\" style=\"padding:0\" v-for=\"(item,index) in tableData\" :key=\"index\">\r\n                    <img style=\"border-radius:50%;width:40px;height:40px;margin-left:20px\" :src=\"$store.state.HOST + item.avatar\">\r\n                    <div style=\"margin-left:10px\">\r\n                        {{item.createBy}}\r\n                    </div>\r\n                    <div style=\"margin-left:20px\">\r\n                        {{item.content}}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <el-pagination\r\n                background\r\n                :page-size=\"search.pageSize\"\r\n                layout=\"prev, pager, next\"\r\n                @current-change=\"handleCurrentChange\"\r\n                :total=\"total\">\r\n            </el-pagination>\r\n        </div>\r\n    </div>\r\n    <el-dialog\r\n    title=\"预约\"\r\n    :visible.sync=\"dialogVisible\"\r\n    width=\"40%\">\r\n    <span>\r\n        <el-input-number  v-model=\"num\" :min=\"1\" :max=\"10\"></el-input-number>\r\n        <el-date-picker  style=\"margin-left:20px\"\r\n        v-model=\"date1\"\r\n        type=\"date\"\r\n        value-format=\"yyyy-MM-dd\"\r\n        placeholder=\"选择预约日期\">\r\n        </el-date-picker>\r\n        <div class=\"attractionsInfo9\" v-for=\"(item,index) in people\" :key=\"index\">\r\n            <el-input  v-model=\"item.name\" placeholder=\"请输入姓名\"></el-input>\r\n            <el-input  style=\"margin-left:10px\" v-model=\"item.tel\" placeholder=\"请输入电话\"></el-input>\r\n            <el-input  v-if=\"info.realName == 1\" style=\"margin-left:10px\" v-model=\"item.idCard\" placeholder=\"请输入身份证号\"></el-input>\r\n            <div v-if=\"index == (people.length - 1)\" @click=\"addKeyword\" style=\"margin-left:10px\"><i class=\"el-icon-circle-plus-outline\"></i></div>\r\n            <div @click=\"minusKeyword(index)\" style=\"margin-left:10px\" v-if=\"index != 0\"><i class=\"el-icon-remove-outline\"></i></div>\r\n        </div>\r\n    </span>\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"closeOrder\" >取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveOrder\"  >确 定</el-button>\r\n    </span>\r\n    </el-dialog>\r\n    <bottoms></bottoms>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {getSysAttractionsById,saveSysAttractionOrder,getSysCommentsPage,saveSysComments} from '../../api/api'\r\n  import headers from '@/components/header'\r\n  import bottoms from '@/components/bottom'\r\n  export default {\r\n    data() {\r\n      return{\r\n        id: \"\",\r\n        dialogVisible: false,\r\n        search: {\r\n          attractionsId: \"\",\r\n          pageSize: 10,\r\n          pageNumber: 1,\r\n        },\r\n        info: {},\r\n        total:100,\r\n        tableData: [],\r\n        content: \"\",\r\n        score: null,\r\n        num: \"\",\r\n        userId: null,\r\n        people: [\r\n            {\r\n                name: \"\",\r\n                tel: \"\",\r\n                idCard: \"\"\r\n            }\r\n        ],\r\n      }\r\n    },\r\n    components: {\r\n      headers,\r\n      bottoms\r\n    },\r\n    methods: {\r\n      saveSysComments() {\r\n          if (!this.content) {\r\n            this.$message({\r\n                message: '请输入评论内容',\r\n                type: 'warning'\r\n            });\r\n            return\r\n          }\r\n          var param = {\r\n              content: this.content,\r\n              score:this.score,\r\n              attractionsId: this.id,\r\n              userId:this.userId\r\n          }\r\n          saveSysComments(param).then(res => {\r\n              if (res.code == 1000) {\r\n                this.$message({\r\n                    message: '评论成功',\r\n                    type: 'success'\r\n                    \r\n                });\r\n                this.content = \"\"\r\n                this.getSysCommentsPage()\r\n              }\r\n          })\r\n      },\r\n      getSysCommentsPage() {\r\n          this.search.attractionsId = this.id\r\n          getSysCommentsPage(this.search).then(res => {\r\n            if (res.code == 1000) {\r\n                this.tableData = res.data.records\r\n                this.total = res.data.total\r\n            }\r\n          })\r\n      },\r\n      closeOrder() {\r\n        this.date1 = \"\"\r\n        this.num = \"\"\r\n        this.people = [\r\n            {\r\n                name: \"\",\r\n                tel: \"\",\r\n                idCard: \"\"\r\n            }\r\n        ],\r\n        this.dialogVisible = false\r\n      },\r\n      saveOrder() {\r\n          if (!this.date1) {\r\n            this.$message({\r\n                message: '请选择预约时间',\r\n                type: 'warning'\r\n            });\r\n            return\r\n          }\r\n          if (this.people.length < this.num) {\r\n            this.$message({\r\n                message: '请完善预约人信息',\r\n                type: 'warning'\r\n            });\r\n            return\r\n          }\r\n          if (this.people.length > this.num) {\r\n            this.$message({\r\n                message: '预约人信息超出预约人数',\r\n                type: 'warning'\r\n            });\r\n            return\r\n          }\r\n          for(let i = 0;i < this.people.length; i++) {\r\n            var item = this.people[i]\r\n            if (!item.name) {\r\n                this.$message({\r\n                    message: '请完善预约人姓名',\r\n                    type: 'warning'\r\n                });\r\n                return\r\n            }\r\n            if (!item.tel) {\r\n                this.$message({\r\n                    message: '请完善预约人联系方式',\r\n                    type: 'warning'\r\n                });\r\n                return\r\n            }\r\n            if (this.info.realName == 1&& !item.idCard ) {\r\n                this.$message({\r\n                    message: '请完善预约人证件号',\r\n                    type: 'warning'\r\n                });\r\n                return\r\n            }\r\n          }\r\n          var param = {\r\n            attractionsId: this.id,\r\n            num: this.num,\r\n            time: this.date1,\r\n            people: JSON.stringify(this.people)\r\n          }\r\n          saveSysAttractionOrder(param).then(res => {\r\n              if (res.code == 1000) {\r\n                this.$message({\r\n                    message: '预约成功，请等待确认',\r\n                    type: 'success'\r\n                });\r\n                this.closeOrder()\r\n              } else {\r\n                this.$message({\r\n                    message: res.message,\r\n                    type: 'warning'\r\n                });\r\n              }\r\n          })\r\n      },\r\n      getSysAttractionsById() {\r\n          getSysAttractionsById({id: this.id}).then(res => {\r\n              if (res.code == 1000) {\r\n                  this.info = res.data\r\n              }\r\n          })\r\n      },\r\n      toOrder() {\r\n          this.dialogVisible = true\r\n      },\r\n      addKeyword() {\r\n        var param = {\r\n            name: \"\",\r\n            tel: \"\",\r\n            idCard: \"\"\r\n        }\r\n        this.people.push(param)\r\n      },\r\n      minusKeyword(index) {\r\n        this.people.splice(index,1)\r\n      },\r\n      handleCurrentChange() {\r\n\r\n      }\r\n    },\r\n    created() {\r\n\r\n    },\r\n    mounted() {\r\n      this.id = this.$route.query.id\r\n      this.userId = JSON.parse(window.localStorage.getItem(\"user_info\")).id\r\n      this.getSysAttractionsById()\r\n      this.getSysCommentsPage()\r\n    }\r\n }\r\n</script>\r\n\r\n<style scoped>\r\n   @import url('../../assets/css/attractionsInfo.css');\r\n</style>\r\n"],"mappings":";AA2FA,SAAAA,qBAAA,EAAAC,sBAAA,EAAAC,kBAAA,EAAAC,eAAA;AACA,OAAAC,OAAA;AACA,OAAAC,OAAA;AACA;EACAC,KAAA;IACA;MACAC,EAAA;MACAC,aAAA;MACAC,MAAA;QACAC,aAAA;QACAC,QAAA;QACAC,UAAA;MACA;MACAC,IAAA;MACAC,KAAA;MACAC,SAAA;MACAC,OAAA;MACAC,KAAA;MACAC,GAAA;MACAC,MAAA;MACAC,MAAA,GACA;QACAC,IAAA;QACAC,GAAA;QACAC,MAAA;MACA;IAEA;EACA;EACAC,UAAA;IACApB,OAAA;IACAC;EACA;EACAoB,OAAA;IACAtB,gBAAA;MACA,UAAAa,OAAA;QACA,KAAAU,QAAA;UACAC,OAAA;UACAC,IAAA;QACA;QACA;MACA;MACA,IAAAC,KAAA;QACAb,OAAA,OAAAA,OAAA;QACAC,KAAA,OAAAA,KAAA;QACAP,aAAA,OAAAH,EAAA;QACAY,MAAA,OAAAA;MACA;MACAhB,eAAA,CAAA0B,KAAA,EAAAC,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAN,QAAA;YACAC,OAAA;YACAC,IAAA;UAEA;UACA,KAAAZ,OAAA;UACA,KAAAd,kBAAA;QACA;MACA;IACA;IACAA,mBAAA;MACA,KAAAO,MAAA,CAAAC,aAAA,QAAAH,EAAA;MACAL,kBAAA,MAAAO,MAAA,EAAAqB,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAjB,SAAA,GAAAgB,GAAA,CAAAzB,IAAA,CAAA2B,OAAA;UACA,KAAAnB,KAAA,GAAAiB,GAAA,CAAAzB,IAAA,CAAAQ,KAAA;QACA;MACA;IACA;IACAoB,WAAA;MACA,KAAAC,KAAA;MACA,KAAAjB,GAAA;MACA,KAAAE,MAAA,IACA;QACAC,IAAA;QACAC,GAAA;QACAC,MAAA;MACA,EACA,EACA,KAAAf,aAAA;IACA;IACA4B,UAAA;MACA,UAAAD,KAAA;QACA,KAAAT,QAAA;UACAC,OAAA;UACAC,IAAA;QACA;QACA;MACA;MACA,SAAAR,MAAA,CAAAiB,MAAA,QAAAnB,GAAA;QACA,KAAAQ,QAAA;UACAC,OAAA;UACAC,IAAA;QACA;QACA;MACA;MACA,SAAAR,MAAA,CAAAiB,MAAA,QAAAnB,GAAA;QACA,KAAAQ,QAAA;UACAC,OAAA;UACAC,IAAA;QACA;QACA;MACA;MACA,SAAAU,CAAA,MAAAA,CAAA,QAAAlB,MAAA,CAAAiB,MAAA,EAAAC,CAAA;QACA,IAAAC,IAAA,QAAAnB,MAAA,CAAAkB,CAAA;QACA,KAAAC,IAAA,CAAAlB,IAAA;UACA,KAAAK,QAAA;YACAC,OAAA;YACAC,IAAA;UACA;UACA;QACA;QACA,KAAAW,IAAA,CAAAjB,GAAA;UACA,KAAAI,QAAA;YACAC,OAAA;YACAC,IAAA;UACA;UACA;QACA;QACA,SAAAf,IAAA,CAAA2B,QAAA,UAAAD,IAAA,CAAAhB,MAAA;UACA,KAAAG,QAAA;YACAC,OAAA;YACAC,IAAA;UACA;UACA;QACA;MACA;MACA,IAAAC,KAAA;QACAnB,aAAA,OAAAH,EAAA;QACAW,GAAA,OAAAA,GAAA;QACAuB,IAAA,OAAAN,KAAA;QACAf,MAAA,EAAAsB,IAAA,CAAAC,SAAA,MAAAvB,MAAA;MACA;MACAnB,sBAAA,CAAA4B,KAAA,EAAAC,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAN,QAAA;YACAC,OAAA;YACAC,IAAA;UACA;UACA,KAAAM,UAAA;QACA;UACA,KAAAR,QAAA;YACAC,OAAA,EAAAI,GAAA,CAAAJ,OAAA;YACAC,IAAA;UACA;QACA;MACA;IACA;IACA5B,sBAAA;MACAA,qBAAA;QAAAO,EAAA,OAAAA;MAAA,GAAAuB,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAnB,IAAA,GAAAkB,GAAA,CAAAzB,IAAA;QACA;MACA;IACA;IACAsC,QAAA;MACA,KAAApC,aAAA;IACA;IACAqC,WAAA;MACA,IAAAhB,KAAA;QACAR,IAAA;QACAC,GAAA;QACAC,MAAA;MACA;MACA,KAAAH,MAAA,CAAA0B,IAAA,CAAAjB,KAAA;IACA;IACAkB,aAAAC,KAAA;MACA,KAAA5B,MAAA,CAAA6B,MAAA,CAAAD,KAAA;IACA;IACAE,oBAAA,GAEA;EACA;EACAC,QAAA,GAEA;EACAC,QAAA;IACA,KAAA7C,EAAA,QAAA8C,MAAA,CAAAC,KAAA,CAAA/C,EAAA;IACA,KAAAY,MAAA,GAAAuB,IAAA,CAAAa,KAAA,CAAAC,MAAA,CAAAC,YAAA,CAAAC,OAAA,eAAAnD,EAAA;IACA,KAAAP,qBAAA;IACA,KAAAE,kBAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}