{"ast":null,"code":"import { mixin } from \"../../minix\";\nimport headerPage from \"../../components/header\";\nimport bottomPage from \"../../components/bottom\";\nimport { getUser, setUserInfo, setUserAvatar, changePassword } from '../../api/api';\nexport default {\n  mixins: [mixin],\n  data() {\n    var checkPhone = (rule, value, callback) => {\n      if (!value) {\n        return callback(new Error('请输入联系电话'));\n      } else {\n        const reg = /^1[3|4|5|7|8][0-9]\\d{8}$/;\n        if (reg.test(value)) {\n          callback();\n        } else {\n          return callback(new Error('请输入正确的联系电话'));\n        }\n      }\n    };\n    return {\n      school: [],\n      major: [],\n      user: {},\n      avatar: [],\n      rules: {\n        userName: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }],\n        email: [{\n          required: true,\n          message: '请输入邮箱地址',\n          trigger: 'blur'\n        }, {\n          type: 'email',\n          message: '请输入正确的邮箱地址',\n          trigger: 'blur'\n        }],\n        tel: [{\n          required: true,\n          validator: checkPhone,\n          message: '请输入正确的联系电话',\n          trigger: 'blur'\n        }]\n      },\n      oldPassword: \"\",\n      newPassword: \"\",\n      passwordDialogVisible: false\n    };\n  },\n  components: {\n    headerPage,\n    bottomPage\n  },\n  methods: {\n    handlePasswordClose() {\n      this.$bus.$emit('password', false);\n    },\n    passwordSubmit() {\n      var param = {\n        id: this.user.id,\n        password: this.oldPassword,\n        newPassword: this.newPassword\n      };\n      changePassword(param).then(res => {\n        if (res.code == 1000) {\n          this.$notify.success({\n            title: '成功',\n            message: \"密码修改成功\"\n          });\n          this.$bus.$emit('password', false);\n        } else {\n          this.$notify.error({\n            title: '错误',\n            message: res.message\n          });\n        }\n      });\n    },\n    submit() {\n      this.$refs[\"ruleForm\"].validate(valid => {\n        if (valid) {\n          setUserInfo(this.user).then(res => {\n            if (res.code == 1000) {\n              this.$message({\n                type: 'success',\n                message: '保存成功!'\n              });\n              this.getUserInfo();\n            } else {\n              this.$notify.error({\n                title: '错误',\n                message: res.message\n              });\n            }\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    getUserInfo() {\n      getUser().then(res => {\n        if (res.code == 1000) {\n          this.user = res.data;\n          this.user.sex = res.data.sex + \"\";\n          this.avatar[0] = this.$store.state.HOST + this.user.avatar;\n        } else {\n          this.$notify.error({\n            title: '错误',\n            message: res.message\n          });\n        }\n      });\n    },\n    changePassword() {\n      //修改密码\n      this.$bus.$emit('password', true);\n    },\n    handleAvatorSuccess(res) {\n      let _this = this;\n      if (res.code == 1000) {\n        _this.$message({\n          type: 'success',\n          message: '上传成功!'\n        });\n      } else {\n        _this.$notify.error({\n          title: '错误',\n          message: res.message\n        });\n      }\n    }\n  },\n  created() {},\n  mounted() {\n    // 监听collapse\n    this.$bus.$on('password', res => {\n      this.passwordDialogVisible = res;\n    });\n    this.getUserInfo();\n  }\n};","map":{"version":3,"names":["mixin","headerPage","bottomPage","getUser","setUserInfo","setUserAvatar","changePassword","mixins","data","checkPhone","rule","value","callback","Error","reg","test","school","major","user","avatar","rules","userName","required","message","trigger","email","type","tel","validator","oldPassword","newPassword","passwordDialogVisible","components","methods","handlePasswordClose","$bus","$emit","passwordSubmit","param","id","password","then","res","code","$notify","success","title","error","submit","$refs","validate","valid","$message","getUserInfo","sex","$store","state","HOST","handleAvatorSuccess","_this","created","mounted","$on"],"sources":["src/views/center/center.vue"],"sourcesContent":["<template>\r\n  <div class=\"centerPage\">\r\n    <headerPage></headerPage>\r\n    <div class=\"centerPage-content\">\r\n    <el-card class=\"box-card\">\r\n        <div class=\"content\">\r\n            <div class=\"master\">\r\n              <el-form style=\"margin-right:20px\" :model=\"user\" :rules=\"rules\" ref=\"ruleForm\" label-width=\"140px\">\r\n                <el-form-item label=\"登陆账号\" prop=\"loginAccount\">\r\n                  <el-input size=\"mini\" disabled v-model=\"user.loginAccount\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"用户名\" prop=\"userName\">\r\n                  <el-input size=\"mini\" v-model=\"user.userName\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"邮箱\" prop=\"email\">\r\n                  <el-input size=\"mini\" v-model=\"user.email\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"联系电话\" prop=\"tel\">\r\n                  <el-input size=\"mini\" v-model=\"user.tel\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"性别\" prop=\"tel\">\r\n                  <el-radio-group v-model=\"user.sex\">\r\n                    <el-radio label=\"0\">男</el-radio>\r\n                    <el-radio label=\"1\">女</el-radio>\r\n                  </el-radio-group>\r\n                </el-form-item>\r\n                <el-form-item label=\"上次修改密码时间\" prop=\"pwdUpdateDate\">\r\n                  <el-input size=\"mini\" disabled v-model=\"user.pwdUpdateDate\"></el-input>\r\n                </el-form-item>\r\n              </el-form>\r\n              <div class=\"submit\">\r\n                  <el-button type=\"primary\" plain size=\"mini\" @click=\"submit\">保存</el-button>\r\n              </div>\r\n            </div>\r\n            <div class=\"slave\">\r\n                <div class=\"img\">\r\n                  <el-image \r\n                    style=\"object-fit: cover;width: 300px; height: 300px;overflow: hidden;border-radius: 50%;\"\r\n                    :src=\"$store.state.HOST + user.avatar\" \r\n                    :preview-src-list=\"avatar\">\r\n                  </el-image>\r\n                </div>\r\n                <div class=\"btns\">\r\n                  <div>\r\n                    <el-upload\r\n                      ref=\"upload\"\r\n                      :action=\"uploadAvatarUrl()+ '/'+ this.user.id\"\r\n                      :show-file-list=\"false\"\r\n                      :before-upload=\"beforeAvatorUpload\"\r\n                      :on-success=\"handleAvatorSuccess\"\r\n                      accept=\"image/*\"\r\n                      >\r\n                      <el-button style=\"margin-top:15px\" size=\"mini\" icon=\"el-icon-picture-outline-round\">修改头像</el-button>\r\n                    </el-upload>\r\n                  </div>\r\n                  <div style=\"margin-top:15px\">\r\n                    <el-button size=\"mini\" icon=\"el-icon-key\" @click=\"changePassword\">修改密码</el-button>\r\n                  </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </el-card>\r\n    </div>\r\n    \r\n    <el-dialog\r\n        title=\"修改密码\"\r\n        :visible.sync=\"passwordDialogVisible\"\r\n        width=\"30%\"\r\n        :before-close=\"handlePasswordClose\">\r\n        <span>请输入{{user.userName}}的旧密码：</span>\r\n        <el-input style=\"margin-top:10px\" show-password v-model=\"oldPassword\" size=\"mini\" autocomplete=\"off\"></el-input>\r\n        <span>请输入{{user.userName}}的新密码：</span>\r\n        <el-input style=\"margin-top:10px\" show-password v-model=\"newPassword\" size=\"mini\" autocomplete=\"off\"></el-input>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button size=\"mini\" @click=\"handlePasswordClose\">取 消</el-button>\r\n          <el-button size=\"mini\" type=\"primary\" @click=\"passwordSubmit\">确 定</el-button>\r\n        </span>\r\n    </el-dialog>\r\n    \r\n    <bottomPage></bottomPage>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {mixin} from \"../../minix\";\r\n  import headerPage from \"../../components/header\"\r\n  import bottomPage from \"../../components/bottom\"\r\n  import {getUser,setUserInfo,setUserAvatar,changePassword} from '../../api/api' \r\n  export default {\r\n    mixins: [mixin],\r\n    data() {\r\n      var checkPhone = (rule, value, callback) => {\r\n          if (!value) {\r\n              return callback(new Error('请输入联系电话'));\r\n          } else {\r\n              const reg = /^1[3|4|5|7|8][0-9]\\d{8}$/\r\n              if (reg.test(value)) {\r\n                  callback();\r\n              } else {\r\n                  return callback(new Error('请输入正确的联系电话'));\r\n              }\r\n          }\r\n      };\r\n      return{\r\n        school: [],\r\n        major: [],\r\n        user: {},\r\n        avatar: [],\r\n        rules: {\r\n          userName: [\r\n            { required: true, message: '请输入用户名', trigger: 'blur' },\r\n          ],\r\n          email: [\r\n            { required: true, message: '请输入邮箱地址', trigger: 'blur' },\r\n            { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }\r\n          ],\r\n          tel: [\r\n            { required: true, validator:checkPhone, message: '请输入正确的联系电话', trigger: 'blur' },\r\n          ],\r\n        },\r\n        oldPassword: \"\",\r\n        newPassword: \"\",\r\n        passwordDialogVisible: false,\r\n      }\r\n    },\r\n    components: {\r\n      headerPage,\r\n      bottomPage\r\n    },\r\n    methods: {\r\n      handlePasswordClose() {\r\n        this.$bus.$emit('password', false)\r\n      },\r\n      passwordSubmit() {\r\n        var param = {\r\n          id: this.user.id,\r\n          password: this.oldPassword,\r\n          newPassword: this.newPassword\r\n        }\r\n        changePassword(param).then(res => {\r\n          if(res.code == 1000) {\r\n            this.$notify.success({\r\n              title: '成功',\r\n              message: \"密码修改成功\"\r\n            });\r\n            this.$bus.$emit('password', false)\r\n          } else {\r\n            this.$notify.error({\r\n              title: '错误',\r\n              message: res.message\r\n            });\r\n          }\r\n        })\r\n      },\r\n      submit() {\r\n        this.$refs[\"ruleForm\"].validate((valid) => {\r\n          if (valid) {\r\n            setUserInfo(this.user).then(res => {\r\n              if(res.code == 1000) {\r\n                this.$message({\r\n                  type: 'success',\r\n                  message: '保存成功!'\r\n                });\r\n                this.getUserInfo()\r\n              } else {\r\n                this.$notify.error({\r\n                  title: '错误',\r\n                  message: res.message\r\n                });\r\n              }\r\n            })\r\n          } else {\r\n            return false;\r\n          }\r\n        });\r\n      },\r\n      getUserInfo() {\r\n        getUser().then(res => {\r\n            if(res.code == 1000) {\r\n              this.user = res.data\r\n              this.user.sex = res.data.sex + \"\"\r\n              this.avatar[0] = this.$store.state.HOST + this.user.avatar\r\n            } else {\r\n              this.$notify.error({\r\n                title: '错误',\r\n                message: res.message\r\n              });\r\n            }\r\n        })\r\n      },\r\n      changePassword() {\r\n        //修改密码\r\n        this.$bus.$emit('password', true)\r\n      },\r\n      handleAvatorSuccess(res){\r\n        let _this = this;\r\n        if(res.code == 1000){\r\n            _this.$message({\r\n              type: 'success',\r\n              message: '上传成功!'\r\n            });\r\n        }else{\r\n          _this.$notify.error({\r\n            title: '错误',\r\n            message: res.message\r\n          });\r\n        }\r\n      },\r\n    },\r\n    created() {\r\n     \r\n    },\r\n    mounted() {\r\n      // 监听collapse\r\n      this.$bus.$on('password', res=>{\r\n        this.passwordDialogVisible = res\r\n      })\r\n      this.getUserInfo()\r\n    }\r\n }\r\n</script>\r\n\r\n<style scoped>\r\n  .centerPage {\r\n      width: 100%;\r\n      height: 100%;\r\n  }\r\n  .centerPage-content {\r\n      width: 100%;\r\n      display: flex;\r\n      justify-content: center;\r\n  }\r\n  .box-card {\r\n      margin-top: 30px;\r\n      margin-bottom: 30px;\r\n      width: 70%;\r\n  }\r\n  .content {\r\n      width: 100%;\r\n      height: 550px;\r\n      display: flex;\r\n      flex-direction: row;\r\n      font-family: \"黑体\";\r\n  }\r\n  .master {\r\n      width: 60%;\r\n      border-right: 1px solid #E5E5E5;\r\n  }\r\n  .submit {\r\n    width: 100%;\r\n    text-align: center;\r\n  }\r\n  .slave {\r\n      width: 40%;\r\n  }\r\n  .img {\r\n      width: 100%;\r\n      height: 75%;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n  }\r\n  .btns {\r\n      width: 100%;\r\n      height: 25%;\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n  }\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}